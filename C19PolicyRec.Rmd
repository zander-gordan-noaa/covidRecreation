---
title: "COVID-19 Policy Stringency and Outdoor Recreation: The Case of Resident Marine Sportfishing in the United States"
author:
  - name: David W. Carter
    email: david.w.carter@noaa.gov
    affiliation: NOAA Fisheries Southeast Fisheries Science Center
    footnote: Corresponding Author
  - name: Alexander Gordan
    email: alexander.gordan@noaa.gov
    affiliation: ECS
  - name: Sabrina Lovell
    email: sabrina.lovell@noaa.gov
    affiliation: NOAA Fisheries Office of Science and Technology
address:
  - code: NOAA Fisheries Southeast Fisheries Science Center
    address: 75 Virginia Beach Drive, Miami, FL, 33149
  - code: ECS
    address: Department 2, Street, City, State, Zip
  - code: NOAA Fisheries Office of Science and Technology
    address: Department 2, Street, City, State, Zip
header-includes:
   - \usepackage{threeparttable}    
abstract: |
  Governments responded to the Covid-19 pandemic with different policies to curtail the spread of the virus. We show how sportfishing levels are related to the stringency of Covid-19 policies. Specifically, the number of sportfishing trips bears an inverse-U-shaped relationship with Covid-19 policy stringency. 
  
author_summary: |
  He does this and that.
  
bibliography: C19PolicyRec.bib
output: rticles::plos_article
csl: plos.csl
editor_options: 
  chunk_output_type: console
---

_Text based on plos sample manuscript, see <https://journals.plos.org/ploscompbiol/s/latex>_

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(feather)
library(survey)
options(survey.lonely.psu="adjust",multicore=TRUE)
library(tidycensus)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(texreg)
library(cdlTools)
library(kableExtra)
library(ciTools)
library(sandwich)
library(lmtest)

```

```{r,echo=FALSE,warning=FALSE,eval=FALSE}

#RUN ONCE TO CREATE DATASET: EVAL SET TO FALSE AFTER

#census_api_key("dc352be83efcd7e4189b8a5d1be652187e50c66d",install=TRUE)

#Load Atlantic and Gulf of Mexico MRIP data
trips=read_feather("trips1720.feather")
#Remove observations:
#without weights
#without months
#headboats
#non-residents 
#aggregate(I(ST_RES==ST)~MODE_FX+YEAR,FUN=mean,data=trips)
trips=subset(trips,wp_int>0 & month!=99 & MODE_FX!=4 & ST==ST_RES)

#Create counting variable for aggregation purposes
trips$one=1

#Mark party size of trips greather than 12 people as missing
#99% if of trips have less than 13 people
#cumsum(prop.table(table(trips$PARTY[trips$MODE_FX==7])))
#cumsum(prop.table(table(trips$PARTY[trips$MODE_FX==5])))
trips$PARTY[trips$PARTY>12]=NA

#Marking hours fished greather than 24 hours as missing
#table(trips$HRSF,useNA = "always")
trips$HRSF[trips$HRSF>24]=NA


#Merge in distance dataset TO DO


#Trips survey design object
tripss=svydesign(id=~psu_id, strata=~strat_id,weights=~wp_int, data=trips)

#Estimated trips by year, month, mode, and state
tripsT=svyby(~one,~YEAR+month+MODE_FX+ST,FUN=svytotal,design=tripss,drop.empty.groups=FALSE)

#Estimated trips by year, month, mode, and state
tripsM=svyby(~HRSF+PARTY,~YEAR+month+MODE_FX+ST,FUN=svymean,design=tripss,drop.empty.groups=FALSE)

#Combining the monthly observation datasets
tripsTM=merge(tripsT,tripsM,by=c("YEAR","month","MODE_FX","ST"))

#Setting missing trip estimates to zero and preparing variables for merge
tripsTM$one[is.na(tripsTM$one)]=0
tripsTM$HRSF[is.na(tripsTM$HRSF)]=0
tripsTM$PARTY[is.na(tripsTM$PARTY)]=0


#Proportional standard error for each estimate
tripsTM$Trips_pse=with(tripsTM,ifelse(one>0,se/one,NA))
tripsTM$Hrsf_pse=with(tripsTM,ifelse(HRSF>0,se.HRSF/HRSF,NA))
tripsTM$Party_pse=with(tripsTM,ifelse(PARTY>0,se.PARTY/PARTY,NA))


tripsTM$MONTH=as.numeric(tripsTM$month)
tripsTM$year=as.numeric(as.character(tripsTM$YEAR))
tripsTM$fips=as.numeric(as.character(tripsTM$ST))



â—‹#Function to retrieve annual state population estimates from ACS
acsY = function(y) {
  d=get_acs(geography = "state", 
            variables = "B01001_001", 
            year = y,
            survey = "acs1")
  d$year=y
  return(d)
}

#Retrieve state population estimates for 2017-2019
pop=do.call(rbind,lapply(2017:2019,FUN=function(x) acsY(x)))

#Get 2020 Census state population estimates and merge to the prior years
pop20 <- get_decennial(geography = "state", 
                       variables = "P1_001N", 
                       year = 2020)
pop20$year=2020
pop20=plyr::rename(pop20,replace=c("value" = "estimate"))
pop=plyr::rbind.fill(pop,pop20)
pop$fips=as.numeric(pop$GEOID)

#Merge the population estimates to the trip dataset year and state
tripsTMP=merge(tripsTM,pop,by.x=c("year","fips"),by.y=c("year","fips"),all.x=TRUE)

#Download daily stringency index for US states and reshape into a long dataset
#https://github.com/OxCGRT/USA-covid-policy
stringentw= openxlsx::read.xlsx(xlsxFile = "OxCGRTUS_timeseries_all.xlsx", sheet = 1)
stringent <- reshape::melt(stringentw, id=names(stringentw[1:5]))

#Create month, year, and state fips variables that are compatible withe the trip dataset
stringent$month=match(substr(stringent$variable,3,5),month.abb)
stringent$year=as.numeric(substr(stringent$variable,6,9))
stringent$fips=fips(stringent$region_name)

#Create an aggregated stringency dataset by summing the index by state, year, and month
stringentm=aggregate(value~year+month+fips,FUN=sum,data=stringent,na.rm=TRUE)

#Merge stringency index data with trip data by year, month, and state
tripsTMPS=merge(tripsTMP,stringentm,by.x=c("year","MONTH","fips"),by.y=c("year","month","fips"),all.x=TRUE)
tripsTMPS$value[is.na(tripsTMPS$value)]=0

#Cleaning up and naming variables in dataset
tripsTMPS=subset(tripsTMPS,select=-c(YEAR,MONTH,variable,moe,fips,ST))
names(tripsTMPS)=c("Year","Month","Mode","Trips","Trips_se","Hrsf","Party",
                   "Hrsf_se","Party_se",
                   "Trips_pse","Hrsf_pse","Party_pse",
                   "FIPS","State","Population","Stringency")

#Trips per capita
tripsTMPS$TPC=tripsTMPS$Trips/tripsTMPS$Population

#Save the final dataset
saveRDS(tripsTMPS,"tripsTMPS.rds")

```

```{r loadData,echo=FALSE,warning=FALSE}
#Load the final dataset
tripsTMPS=readRDS("tripsTMPS.rds")

```

# Introduction

* Intro to C-19 and the anecdotal evidence related to C-19 and recreation
* Literature review
* Research question: How do outdoor recreation levels change as governments institute policies to protect public health during a pandemic?
* Approach: variation in state stringency policies to describe the relationship between C-19 and sportfishing levels

Landry et al (2021) provide a useful summary of potential causal pathways through which COVID-19 may affect outdoor recreation:

1. blah

2. Blah blah

3. Blah blah blah

To which we may add:

4. Etc

5. Etc etc




# Methods

## Data

We assemble monthly observations from 2017-2020 for three different modes of fishing: private boats, charter boats, and shore. With `r length(unique(tripsTMPS$Year))` years, `r length(unique(tripsTMPS$Month))` months in each year and `r length(unique(tripsTMPS$State))` states, the data set for each mode has `r length(tripsTMPS$Trips[tripsTMPS$Mode==7])` observations. 

* MRIP monthly estimates (via program) by mode (private, charter, shore) for each state bordering the Atlantic and Gulf of Mexico
  + refer to MRIP website with template programs
  + potential issue with PSEs
  + Only residents (show percentage of res. vs nonres.)

* Annual population estimates for each state bordering the Atlantic and Gulf of Mexico
  + 2017-2019: ACS
  + 2020 Census
  
* Monthly C-19 Stringency index for each state bordering the Atlantic and Gulf of Mexico
  + daily estimates summed to each month
  + higher numbers equate with more stringent policies


```{r private_boat_trips_seasonality_plot,echo=FALSE,warning=FALSE,fig.height=6,fig.width=5,fig.align='center', fig.cap="2019 Monthly Marine Sportfishing Trips per Capita by State. The seasonal profile of each state is plotted as a separate grey line, with each month's value expressed as a percentage of the peak month. The bold line gives a simple average of these relative monthly values across the 16 states."}
tripsTMPS %>%
  filter(Mode == 7 & Year == 2019) %>%
  group_by(State) %>% 
  mutate(relative_TPC = TPC / max(TPC)) %>% 
  ggplot(aes(x=Month, y=relative_TPC, group=State)) +
  geom_line(alpha = 0.08) +
  stat_summary(mapping = aes(x=Month,  y=relative_TPC, group = 1), 
               fun = "mean", 
               geom = "line",
               inherit.aes = FALSE) +
  ylab("Trips (relative to peak trips)") +
  ggtitle("Private Boats")
```

```{r pTrips,echo=FALSE,warning=FALSE,fig.cap="2020 Monthly Marine Sportfishing Trips per Capita by State",fig.height=6,fig.width=5,fig.align='center'}
tripsTMPS %>%
  filter(Mode == 5 & Year > 2019) %>%
  ggplot( aes(x=Month,y=TPC, group=State, color=State)) +
  geom_line() + 
  ylab("Trips per capita") +
  ggtitle("Charter Boats")

tripsTMPS %>%
  filter(Mode == 3 & Year > 2019) %>%
  ggplot( aes(x=Month,y=TPC, group=State, color=State)) +
  geom_line() + 
  ylab("Trips per capita") +
  ggtitle("Shore")
```

```{r pString,echo=FALSE,warning=FALSE,fig.cap="Monthly 2020 stringency Index by State",fig.height=6,fig.width=5,fig.align='center'}
tripsTMPS %>% 
  filter(Year > 2019) %>%
  ggplot( aes(x=Month,y=Stringency, group=State, color=State)) +
  geom_line() + 
  ylab("stringency")

```

```{r tripsVstring,echo=FALSE,warning=FALSE,fig.cap="Average Trips per Capita versus Covid-19 Policy Stringency",fig.height=6,fig.width=5,fig.align='center'}

with(subset(mbms,Mode==7),
     plot(TPCdTPClt20 ~Stringency,pch=NA,main="Private Boats",xlim=c(1000,2000),
          ylab="Trips per Capita Ratio",xlab="Covid-19 Policy Stringency"))
with(subset(mbms,Mode==7 ),
     text(TPCdTPClt20 ~Stringency,font=2,cex=0.75,
          labels=State[Mode==7 ]))

with(subset(mbms,Mode==5 ),
     plot(TPCdTPClt20 ~Stringency,pch=NA,main="Charter Boats",xlim=c(1000,2000),
          ylab="Trips per Capita Ratio",xlab="Covid-19 Policy Stringency"))
with(subset(mbms,Mode==5 ),
     text(TPCdTPClt20 ~Stringency,font=2,cex=0.75,
          labels=State[Mode==5 ]))

with(subset(mbms,Mode==3 ),
     plot(TPCdTPClt20 ~Stringency,pch=NA,main="Shore",xlim=c(1000,2000),
          ylab="Trips per Capita Ratio",xlab="Covid-19 Policy Stringency"))
with(subset(mbms,Mode==3 ),
     text(TPCdTPClt20 ~Stringency,font=2,cex=0.75,
          labels=State[Mode==3 ]))

```



## Modeling Approach

Quasi-poisson regression estimated with mean equal to $exp(pop)*exp(xb)$ and variance equal to $scale*mean$.

# Results
Our results represent a composite effect of the actual local COVID policies, as well as localized attitudes, risk tolerances, and beliefs about COVID-19 which are correlated with COVID stringency. In particular, we see the inverse-U relationship we find to be the outcome of 2 countervailing pathways (laid out in the background section), (1) stringency reduces available substitutes of indoor or high-density outdoor activities, increasing the attractiveness of fishing, which is the dominant force on the low-stringency side of the curve, and (2) COVID risk makes even a relatively distanced activity, such as fishing, less appealing compared to entirely in-home activities such as cooking, backyard games, video games, etc., which is the dominating force on the high-stringency side of the curve.

```{r sumSat,echo=FALSE,warning=FALSE,results='asis',message=FALSE}

# ssbym=as.data.frame(t(aggregate(cbind(Trips,Hrsf,Party,Stringency)~Mode,data=tripsTMPS,
#           FUN=function(x) cbind(mean(x), median(x), sd(x)))))
# 
# names(ssbym)=c("Shore","Charter","Private")
# rownames(ssbym)=c("Mode",rep(c("Mean","Median","St. Dev."),4))
# 
# kbl(ssbym[-1,],row.names = rep(c("Mean","Median","St. Dev."),4)) %>%
#   kable_classic() %>%
#   pack_rows("Trips", 1, 3) %>%
#   pack_rows("Hours Fished", 4, 6)  %>%
#   pack_rows("Party Size", 7, 9)  %>%
#   pack_rows("Stringency", 10, 12)

library(vtable)
st(tripsTMPS[,c("Trips","Hrsf","Party","Stringency","Mode")],
   group = 'Mode', group.test = FALSE,group.long = TRUE,
   title="Summary Statistics by Mode",
   out="latex")

```



```{r pfe,echo=FALSE,warning=FALSE}

#Fixed effect poisson regressions of trips on stringency index with a population offset
#Modeling trips per capita
mf=formula(Trips ~ State + Month + I(Stringency/100) + I((Stringency/100)^2) + offset(log(Population)))
pm=glm(mf,data=tripsTMPS,family = quasipoisson,subset=Mode==7 )
cm=glm(mf,data=tripsTMPS,family = quasipoisson,subset=Mode==5 )
sm=glm(mf,data=tripsTMPS,family = quasipoisson,subset=Mode==3 )

```

```{r regTbl,echo=FALSE,warning=FALSE,results='asis'}

staten=gsub("State","",names(coef(pm)))[2:16]

texreg(list(pm,cm,sm),custom.model.names = c("Private","Charter","Shore"),single.row = FALSE,digits=3,label="regResults",
       caption = "Quasi-Poisson Fixed Effect Regression of Trips on Covid-19 Stringency by Mode",
       #custom.coef.names = c("Intercept",staten,month.name[-1],
       #                       "Stringency/100","(Stringency/100)^2"),
       custom.coef.map=list("(Intercept)" = "Intercept",
                            "I(Stringency/100)"="Stringency/100","I((Stringency/100)^2)"="(Stringency/100)^2"),
       include.aic=FALSE,include.bic=FALSE,include.loglik=FALSE,caption.above = TRUE,
       custom.note = "%stars. The base state is Alabama and the base Month is January.",
       custom.gof.rows = list("Scale" = c(summary(pm)$dispersion,summary(cm)$dispersion,summary(sm)$dispersion)))


```

```{r statesFEplot,echo=FALSE,warning=FALSE,fig.cap="State Fixed Effects for Trips by Mode",fig.height=8,fig.width=4,message=FALSE}

bn=list( "StateConnecticut" = "Connecticut",
         "StateDelaware" = "Delaware",
         "StateFlorida" = "Florida",
         "StateGeorgia" = "Georgia",
         "StateMaine" = "Maine", 
         "StateMaryland" = "Maryland",
         "StateMassachusetts" = "Massachusetts",
         "StateMississippi" = "Mississippi",
         "StateNew Hampshire" = "New Hampshire",
         "StateNew Jersey" = "New Jersey",
         "StateNew York" = "New York",
         "StateNorth Carolina" = "North Carolina",
         "StateRhode Island" = "Rhode Island",
         "StateSouth Carolina" = "South Carolina",
         "StateVirginia" = "Virginia",      
         "Month02" = "February",
         "Month03" = "March",
         "Month04" = "April",
         "Month05" = "May", 
         "Month06" = "June",
         "Month07" = "July",
         "Month08" = "August",
         "Month09" = "September",
         "Month10" = "October", 
         "Month11" = "November",
         "Month12" = "December" )

plotreg(list(pm,cm,sm),custom.model.names = c("Private","Charter","Shore"),
        custom.coef.map=bn[2:15])


```


```{r monthsFEplot,echo=FALSE,warning=FALSE,fig.cap="Months Fixed Effects for Trips by Mode",fig.height=8,fig.width=4,message=FALSE}

plotreg(list(pm,cm,sm),custom.model.names = c("Private","Charter","Shore"),
        custom.coef.map=bn[16:27])

```


```{r tripStringRel,echo=FALSE,warning=FALSE,fig.cap="Predicted Trips as a Function of the Stringency Index",fig.height=8,fig.width=4}

#Dataset to predict trips as a function of stringency
#holding everything else constant.
#Using June in Florida: zero stringency should correspond with
#the mean historical trips in Florida during June
nd=data.frame(State="Florida",Month="06",
              Population=with(tripsTMPS,mean(Population[State=="Florida" & Month=="06"])),
              Stringency=seq(0,3000,by=50))

#Predicted trips as a function of stringency, including confidence intervals
pd=add_ci(nd,pm)
cd=add_ci(nd,cm)
sd=add_ci(nd,sm)

#Plot predicted trips and confidence intervals
par(mfrow=c(3,1))

plot(y=pd$pred/1000000,x=pd$Stringency,type="l",ylim=c(2,5),
     main="Private Boats",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Millions of Fishing Trips (Scaled to June in FL)")
lines(y=pd$LCB0.025/1000000,x=pd$Stringency,lty=2)
lines(y=pd$UCB0.975/1000000,x=pd$Stringency,lty=2)

plot(y=cd$pred/1000000,x=cd$Stringency,type="l",ylim=c(.04,.09),
     main="Charter Boats",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Millions of Fishing Trips (Scaled to June in FL)")
lines(y=cd$LCB0.025/1000000,x=pd$Stringency,lty=2)
lines(y=cd$UCB0.975/1000000,x=pd$Stringency,lty=2)

plot(y=sd$pred/1000000,x=sd$Stringency,type="l",ylim=c(3,7),
     main="Shore",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Millions of Fishing Trips (Scaled to June in FL)")
lines(y=sd$LCB0.025/1000000,x=pd$Stringency,lty=2)
lines(y=sd$UCB0.975/1000000,x=pd$Stringency,lty=2)

par(mfrow=c(1,1))

#Use this to reverse the x-axis: xlim=c(3000,0)

#Don't think that we need robust standard error with the
#Quasi-poisson, but here is how you would calculate them
#coeftest(pm, vcov = vcovHC(pm, type="HC4"))

#Bootstrapped prediction CI to verify (takes long to run as currently coded)
# library(boot)
# 
# bf=function(d,i){
#   pm=glm(mf,data=d[i,],family = quasipoisson )
#   pd=predict(pm,newdata = nd,type="response")/1000000
#   return(pd)
# }
# 
# bcp=boot(subset(tripsTMPS,Mode==7),bf,R=1000)
# zz=sapply(1:61,FUN=function(i) boot.ci(boot.out = bcp, type = c("bca"),index=i)$bca)
# 
# plot(pd,type="l",ylim=c(2,6))
# lines(zz[4,],lty=2)
# lines(zz[5,],lty=2)

```

```{r lmfeh,echo=FALSE,warning=FALSE}

#Fixed effect regressions of mean hours fished on stringency index 
mfh=formula(Hrsf ~ State + Month + I(Stringency/100) + I((Stringency/100)^2))
pmh=lm(mfh,data=tripsTMPS,subset=Mode==7 )
cmh=lm(mfh,data=tripsTMPS,subset=Mode==5 )
smh=lm(mfh,data=tripsTMPS,subset=Mode==3 )

pmhr <- coeftest(pmh, vcov = vcovHC)
pse <- pmhr[, 2]
ppval <- pmhr[, 4]

cmhr <- coeftest(cmh, vcov = vcovHC)
cse <- cmhr[, 2]
cpval <- cmhr[, 4]

smhr <- coeftest(smh, vcov = vcovHC)
sse <- smhr[, 2]
spval <- smhr[, 4]

```

```{r regTblh,echo=FALSE,warning=FALSE,results='asis'}

texreg(list(pmh,cmh,smh),custom.model.names = c("Private","Charter","Shore"),single.row = FALSE,digits=3,label="regResultsh",
       caption = "Linear Fixed Effect Regression of Mean Monthly Hours Fished on Covid-19 Stringency by Mode",
       # custom.coef.names = c("Intercept",staten,month.name[-1],
       #                       "Stringency/100","(Stringency/100)^2"),
       custom.coef.map=list("(Intercept)" = "Intercept",
                            "I(Stringency/100)"="Stringency/100","I((Stringency/100)^2)"="(Stringency/100)^2"),
       include.aic=FALSE,include.bic=FALSE,include.loglik=FALSE,caption.above = TRUE,
       custom.note = ("\\parbox{.6\\linewidth}{\\vspace{2pt} %stars based on robust standard errors. \\\\
                      The base state is Alabama and the base Month is January.}"),
       override.se=list(pse,cse,sse),override.pvalues=list(ppval,cpval,spval))
```


```{r statesFEploth, echo=FALSE, fig.cap="State Fixed Effects for Hours Fished by Mode", fig.height=8, fig.width=4, warning=FALSE,message=FALSE}

plotreg(list(pmh,cmh,smh),custom.model.names = c("Private","Charter","Shore"),
        custom.coef.map=bn[2:15])


```


```{r monthsFEploth,echo=FALSE,warning=FALSE,fig.cap="Months Fixed Effects for Hours Fished by Mode",fig.height=8,fig.width=4,message=FALSE}

plotreg(list(pmh,cmh,smh),custom.model.names = c("Private","Charter","Shore"),
        custom.coef.map=bn[16:27])

```

```{r tripStringRelh,echo=FALSE,warning=FALSE,fig.cap="Predicted Hours Fished as a Function of the Stringency Index",fig.height=8,fig.width=4}

#Predicted trips as a function of stringency, including confidence intervals
pdh=add_ci(nd,pmh)
cdh=add_ci(nd,cmh)
sdh=add_ci(nd,smh)

#Plot predicted trips and confidence intervals
par(mfrow=c(3,1))

plot(y=pdh$pred,x=pd$Stringency,type="l",ylim=c(3.5,5.5),
     main="Private Boats",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Mean Hours Fished (Scaled to June in FL)")
lines(y=pdh$LCB0.025,x=pd$Stringency,lty=2)
lines(y=pdh$UCB0.975,x=pd$Stringency,lty=2)

plot(y=cdh$pred,x=cd$Stringency,type="l",ylim=c(3,7),
     main="Charter Boats",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Mean Hours Fished (Scaled to June in FL)")
lines(y=cdh$LCB0.025,x=pd$Stringency,lty=2)
lines(y=cdh$UCB0.975,x=pd$Stringency,lty=2)

plot(y=sdh$pred,x=sd$Stringency,type="l",ylim=c(3,5.5),
     main="Shore",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Mean Hours Fished (Scaled to June in FL)")
lines(y=sdh$LCB0.025,x=pd$Stringency,lty=2)
lines(y=sdh$UCB0.975,x=pd$Stringency,lty=2)

par(mfrow=c(1,1))


```



```{r lmfep,echo=FALSE,warning=FALSE}

#Fixed effect regressions of mean hours fished on stringency index 
mfp=formula(Party ~ State + Month + I(Stringency/100) + I((Stringency/100)^2))
pmp=lm(mfp,data=tripsTMPS,subset=Mode==7 )
cmp=lm(mfp,data=tripsTMPS,subset=Mode==5 )
smp=lm(mfp,data=tripsTMPS,subset=Mode==3 )

pmpr <- coeftest(pmp, vcov = vcovHC)
psep <- pmpr[, 2]
ppvalp <- pmpr[, 4]

cmpr <- coeftest(cmp, vcov = vcovHC)
csep <- cmpr[, 2]
cpvalp <- cmpr[, 4]

smpr <- coeftest(smp, vcov = vcovHC)
ssep <- smpr[, 2]
spvalp <- smpr[, 4]

```

```{r regTblp,echo=FALSE,warning=FALSE,results='asis'}

texreg(list(pmp,cmp,smp),custom.model.names = c("Private","Charter","Shore"),single.row = FALSE,digits=3,label="regResultsp",
       caption = "Linear Fixed Effect Regression of Mean Fishing Party Size on Covid-19 Stringency by Mode",
       # custom.coef.names = c("Intercept",staten,month.name[-1],
       #                       "Stringency/100","(Stringency/100)^2"),
       custom.coef.map=list("(Intercept)" = "Intercept",
                            "I(Stringency/100)"="Stringency/100","I((Stringency/100)^2)"="(Stringency/100)^2"),
       include.aic=FALSE,include.bic=FALSE,include.loglik=FALSE,caption.above = TRUE,
       custom.note = ("\\parbox{.6\\linewidth}{\\vspace{2pt} %stars based on robust standard errors. \\\\
                      The base state is Alabama and the base Month is January.}"),
       override.se=list(psep,csep,ssep),override.pvalues=list(ppvalp,cpvalp,spvalp))
```


```{r statesFEplotp,echo=FALSE,warning=FALSE,fig.cap="State Fixed Effects for Party Size by Mode",fig.height=8,fig.width=4,message=FALSE}

plotreg(list(pmp,cmp,smp),custom.model.names = c("Private","Charter","Shore"),
        custom.coef.map=bn[2:15])


```


```{r monthsFEplotp,echo=FALSE,warning=FALSE,fig.cap="Months Fixed Effects for Party Size Fished by Mode",fig.height=8,fig.width=4,message=FALSE}

plotreg(list(pmp,cmp,smp),custom.model.names = c("Private","Charter","Shore"),
        custom.coef.map=bn[16:27])

```

```{r tripStringRelp,echo=FALSE,warning=FALSE,fig.cap="Predicted Party Size as a Function of the Stringency Index",fig.height=8,fig.width=4}

#Predicted party size as a function of stringency, including confidence intervals
pdp=add_ci(nd,pmp)
cdp=add_ci(nd,cmp)
sdp=add_ci(nd,smp)

#Plot predicted party size and confidence intervals
par(mfrow=c(3,1))

plot(y=pdp$pred,x=pd$Stringency,type="l",ylim=c(2,5),
     main="Private Boats",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Mean Party Size (Scaled to June in FL)")
lines(y=pdp$LCB0.025,x=pd$Stringency,lty=2)
lines(y=pdp$UCB0.975,x=pd$Stringency,lty=2)

plot(y=cdp$pred,x=cd$Stringency,type="l",ylim=c(3,7),
     main="Charter Boats",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Mean Party Size ( (Scaled to June in FL)")
lines(y=cdp$LCB0.025,x=pd$Stringency,lty=2)
lines(y=cdp$UCB0.975,x=pd$Stringency,lty=2)

plot(y=sdp$pred,x=sd$Stringency,type="l",ylim=c(3,5.5),
     main="Shore",
     xlab="Stringincy Index (Monthly sum of daily records: higher is more stringent)",
     ylab="Mean Party Size ( (Scaled to June in FL)")
lines(y=sdp$LCB0.025,x=pd$Stringency,lty=2)
lines(y=sdp$UCB0.975,x=pd$Stringency,lty=2)

par(mfrow=c(1,1))


```


# References {#references .unnumbered}
